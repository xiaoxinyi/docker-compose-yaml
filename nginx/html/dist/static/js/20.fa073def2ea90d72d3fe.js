webpackJsonp([20],{1296:function(t,e,i){var s=i(1297);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);i(590)("2d3d0dba",s,!0,{})},1297:function(t,e,i){(t.exports=i(589)()).push([t.i,".customer-list-title[data-v-615a60e2]{height:50px;line-height:50px;font-size:16px;padding-left:30px;border-bottom:1px solid #DDD}.customer-list-content[data-v-615a60e2]{padding:35px}.customer-list-content .page[data-v-615a60e2]{height:100px;position:relative}.customer-list-content .page ul.ivu-page[data-v-615a60e2]{position:absolute;top:35px;right:0}.ivu-table .demo-table-vip-row td[data-v-615a60e2]{background-color:#FFF5E4}.add-new-clerk-base-info-content-avatar img[data-v-615a60e2]{margin-left:30px}.similar-costomer-img-content img[data-v-615a60e2]{position:absolute;top:0;left:0}.current-visit-modal-head[data-v-615a60e2]{float:left;margin-top:100px;margin-bottom:20px}.current-visit-modal-head p[data-v-615a60e2]{height:30px;line-height:30px;text-align:center;font-weight:700;font-size:14px}.current-visit-modal-table[data-v-615a60e2]{float:right}",""])},1298:function(t,v,g){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),function(s){var t,e,i=g(305),r=g.n(i),n=g(306),a=g.n(n),o=g(307),u=g(83),c=g(122),l=g(1299),d=g.n(l),m=g(884),p=g(1);g.n(p);v.default={created:function(){this.setVisitColumnTitles()},data:function(){return{visitDisabled:!1,showDbResetModal:!1,visitingData:{},pageSize:10,visitingTotal:0,visitingCustomerList:[],timerGetVisitingCustomer:{refreshTime:5e3,timer:null},page:1,showMergeVisitToCustomerModal:!1,currentVisit:{similarCustomerColumns:[],visitId:null,visitCapture:"",similarOldCustomerList:[],threshold:1.5},isEmitSearch:!1,visitColumnTitle:[],searchCondition:[],searchConditionObject:{},itemFunctionMapping:{name:m.b.equalsearch,gender:m.b.equalsearch,age:m.b.orsearch,visit_time:m.b.rangesearch,important_level:m.b.orsearch},utcDateRange:[]}},computed:{visitingList:function(){return s.isEmpty(this.visitingCustomerList)?[]:s.map(this.visitingCustomerList,this.formatVisit)}},components:{appVisitingSearch:d.a},watch:{"visitingData.total":{handler:"updateVistingCustomers",deep:!0}},sockets:{similarities_cus_by_visit:function(t){if(t){var e=JSON.parse(t);for(var i in e){var s=e[i];s.customerId=s.id,s.customerCapture=c.a.appendPrefixStaticUrl(s.customer_capture)}this.currentVisit.similarOldCustomerList=e,this.currentVisit.similarOldCustomerList.sort(function(t,e){return t.difference-e.difference})}}},mounted:function(){var t=this;this.$store.dispatch("loadStateList").then(function(){t.visitingCustomerList=[],clearInterval(u.a.timerGetVisitingCustomer),t.getVisitingCustomers(),t.timerGetVisitingCustomer.timer=setInterval(t.getVisitingCustomers,t.timerGetVisitingCustomer.refreshTime)}),this.appendSimilarCustomerColumns()},beforeDestroy:function(){clearInterval(this.timerGetVisitingCustomer.timer)},methods:{changePage:(e=a()(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return clearInterval(this.timerGetVisitingCustomer.timer),this.page=e,this.visitingCustomerList=[],t.next=5,this.getVisitingCustomers(this.searchCondition);case 5:this.updateVistingCustomers(),this.isDefault(this.searchCondition)&&(this.timerGetVisitingCustomer.timer=setInterval(this.getVisitingCustomers,this.timerGetVisitingCustomer.refreshTime),this.isEmitSearch=!1,this.searchCondition=[],this.searchConditionObject={});case 7:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)}),formatVisit:function(t){var e={};return e.customer_id=t.customer_id,e.local_visit_id=t.local_visit_id,e.visitCapture=c.a.appendPrefixStaticUrl(t.snapshot_uri),e.customerCapture=c.a.appendPrefixStaticUrl(t.customer_capture),e.inDate=c.a.utcToDate(t.visit_time),e.inTime=c.a.utcToTime(t.visit_time),e.name=t.name?t.name:"未设置",e.age=this.$store.getters.getAgeTextByValue(t.age),e.gender=this.$store.getters.getGenderTextByValue(t.gender),e.customerType=this.$store.getters.getCustomerTypeTextByValue(t.important_level),e},updateVistingCustomers:function(){this.visitingTotal=this.visitingData.total,this.pageSize=this.visitingData.items_num;var t=this.visitingData.visits,e=this.getNewVisits(t);s.isEmpty(e)?this.visitTableLoading=!1:(this.isEmitSearch&&(this.visitingCustomerList=[]),this.visitingCustomerList=s.concat(this.visitingCustomerList,e))},getNewVisits:function(t){var i=this;return s.filter(t,function(e){return-1===s.findIndex(i.visitingCustomerList,function(t){return t.id===e.id})})},searchVisitors:function(t){this.searchCondition=t,this.page=1,clearInterval(this.timerGetVisitingCustomer.timer),this.isEmitSearch=!0,this.visitingCustomerList=[],this.isDefault(this.searchCondition)&&(this.timerGetVisitingCustomer.timer=setInterval(this.getVisitingCustomers,this.timerGetVisitingCustomer.refreshTime),this.isEmitSearch=!1,this.searchCondition=[]),this.getVisitingCustomers(this.searchCondition)},isDefault:function(t){if(s.isEmpty(t))return!0;var e=!0;return e=(e=(e=(e=(e=e&&s.isEmpty(t.name))&&s.isEmpty(t.gender))&&s.isEmpty(t.age))&&s.isEmpty(t.important_level))&&s.isEmpty(t.visit_time)},getVisitingCustomers:(t=a()(r.a.mark(function t(){var e,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o._49(this.page,this.getSearchConditionObject(i));case 2:(e=t.sent)&&200===e.code&&(this.visitingData=e.data);case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)}),getSearchConditionObject:function(t){if(s.isEmpty(t))return{};var e=[];for(var i in t)e.push(this.itemFunctionMapping[i](i,t[i]));return e=Object(m.a)(this.itemFunctionMapping,e)},addVisitToNewCustomer:function(i){var s=this;return a()(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.f(Number(i.visitId));case 2:(e=t.sent)&&200===e.code?(s.$Message.success("成功添加为顾客"),s.changePage(s.page)):s.$Message.warning("店铺处于离线状态");case 4:case"end":return t.stop()}},t,s)}))()},deleteVisit:function(i){var s=this;return a()(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.E(Number(i.visitId));case 2:(e=t.sent)&&200===e.code&&(s.visitingCustomerList=[],s.$Message.success("删除顾客成功"),s.getVisitingCustomers());case 4:case"end":return t.stop()}},t,s)}))()},mergeVisitToOldCustomer:function(i){var s=this;return a()(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s.showMergeVisitToCustomerModal=!0,s.currentVisit.visitId=i.visitId,s.currentVisit.visitCapture=i.visitCapture,s.currentVisit.selectedMergeOldCustomerId=i.customerId,s.currentVisit.similarOldCustomerList=[],t.next=7,o._18(s.currentVisit.visitId,s.currentVisit.threshold);case 7:(e=t.sent)&&200===e.code||s.$Message.warning("店铺处于离线状态");case 9:case"end":return t.stop()}},t,s)}))()},appendSimilarCustomerColumns:function(){var i=this;this.currentVisit.similarCustomerColumns=[{title:"顾客ID",key:"customer_id",align:"center",width:80},{title:"顾客头像",key:"visitCapture",align:"center",render:function(t,e){return t("div",[t("Avatar",{props:{src:e.row.customerCapture,size:"large"}})])}},{title:"操作",key:"action",width:80,align:"center",render:function(t,e){return t("div",[t("Button",{props:{type:"primary",size:"small"},on:{click:function(){i.submitMergeOperation(e.row.customerId)}}},"确定")])}}]},submitMergeOperation:function(i){var s=this;return a()(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o._37(s.currentVisit.visitId,i);case 2:(e=t.sent)&&200===e.code&&(s.showMergeVisitToCustomerModal=!1,s.changePage(1));case 4:case"end":return t.stop()}},t,s)}))()},setVisitColumnTitles:function(){this.visitColumnTitle=[{title:"访客ID",key:"local_visit_id",align:"center",width:80},{title:"顾客ID",key:"customer_id",align:"center",width:140,render:function(t,e){return t("div",[t("p",{},e.row.customerId),t("p",[t("Avatar",{props:{src:e.row.customerCapture,size:"large"}})])])}},{title:"访客头像",width:140,key:"visitCapture",align:"center",render:function(t,e){return t("div",[t("Avatar",{props:{src:e.row.visitCapture,size:"large"}})])}},{title:"姓名",key:"name",align:"center"},{title:"到访时间",key:"inTime",align:"center",render:function(t,e){return t("div",[t("p",{},e.row.inDate),t("p",{},e.row.inTime)])}},{title:"性别",key:"gender",align:"center"},{title:"年龄段",key:"age",align:"center"},{title:"顾客类型",key:"customerType",align:"center"}]}}}}.call(v,g(123))},1299:function(t,e,i){var s=i(304)(i(1302),i(1303),function(t){i(1300)},"data-v-363e2f2a",null);t.exports=s.exports},1300:function(t,e,i){var s=i(1301);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);i(590)("e81afae0",s,!0,{})},1301:function(t,e,i){(t.exports=i(589)()).push([t.i,".row-grid[data-v-363e2f2a]{margin-bottom:5px;margin-top:15px}.item-name[data-v-363e2f2a]{text-align:center;margin-left:auto;margin-right:auto;margin-top:7px}.date-picker-input[data-v-363e2f2a],.info-input[data-v-363e2f2a],.multi-choose[data-v-363e2f2a],.single-choose[data-v-363e2f2a]{width:80%}.select-btn[data-v-363e2f2a]{text-align:center}",""])},1302:function(t,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),function(s){var t=u(311),e=u.n(t),i=u(312),r=u(1),n=u.n(r),a=u(122);o.default={data:function(){return{name:"",gender:[],age:[],dateRange:["",""],customerType:[]}},computed:e()({},Object(i.c)(["genderList","ageList","customerTypeList","getAgeValueListByValue"]),{utcDateRange:function(){if(""===this.dateRange[0]&&""===this.dateRange[1])return["",""];var t=[n()(this.dateRange[0]),n()(this.dateRange[1])];return a.a.timeRangeUtc.apply(a.a,t)}}),methods:e()({},Object(i.b)({loadGenderList:"getGenderListAction",setSelectedGender:"setGender"}),{selectDate:function(t){""===t[0]||""===t[1]?this.dateRange=["",""]:this.dateRange=t},search:function(){var e=this,t=s.flatten(s.map(this.age,function(t){return e.getAgeValueListByValue(t)})),i={name:this.name,gender:this.gender,age:t,visit_time:this.utcDateRange,important_level:this.customerType};this.dateRange.every(function(t){return""===t})&&delete i.visit_time,this.$emit("visitSearch",i)}}),mounted:function(){}}}.call(o,u(123))},1303:function(t,e){t.exports={render:function(){var i=this,t=i.$createElement,s=i._self._c||t;return s("div",[s("Row",{staticClass:"row-grid"},[s("Col",{attrs:{span:"2"}},[s("div",{staticClass:"item-name"},[i._v("姓名")])]),i._v(" "),s("Col",{attrs:{span:"4"}},[s("Input",{staticClass:"info-input",attrs:{disabled:"",placeholder:"姓名"},on:{"on-enter":i.search},model:{value:i.name,callback:function(t){i.name=t},expression:"name"}})],1),i._v(" "),s("Col",{attrs:{span:"2"}},[s("div",{staticClass:"item-name"},[i._v("性别")])]),i._v(" "),s("Col",{attrs:{span:"4"}},[s("Select",{staticClass:"single-choose",attrs:{clearable:"",placeholder:"性别"},model:{value:i.gender,callback:function(t){i.gender=t},expression:"gender"}},i._l(i.genderList,function(t,e){return s("Option",{key:e,attrs:{value:t.value}},[i._v(i._s(t.text))])}))],1),i._v(" "),s("Col",{attrs:{span:"2"}},[s("div",{staticClass:"item-name"},[i._v("年龄")])]),i._v(" "),s("Col",{attrs:{span:"4"}},[s("Select",{staticClass:"multi-choose",attrs:{multiple:"",placeholder:"年龄段"},model:{value:i.age,callback:function(t){i.age=t},expression:"age"}},i._l(i.ageList,function(t,e){return s("Option",{key:e,attrs:{value:t.value}},[i._v(i._s(t.text))])}))],1),i._v(" "),s("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[s("Button",{staticClass:"select-btn",attrs:{type:"info",icon:"ios-search"},on:{click:i.search}},[i._v("搜索")])],1)],1),i._v(" "),s("Row",[s("Col",{attrs:{span:"2"}},[s("div",{staticClass:"item-name"},[i._v("顾客类型")])]),i._v(" "),s("Col",{attrs:{span:"4"}},[s("Select",{staticClass:"multi-choose",attrs:{disabled:"",multiple:"",placeholder:"顾客类型"},model:{value:i.customerType,callback:function(t){i.customerType=t},expression:"customerType"}},i._l(i.customerTypeList,function(t,e){return s("Option",{key:e,attrs:{value:t.value}},[i._v(i._s(t.text))])}))],1),i._v(" "),s("Col",{attrs:{span:"2"}},[s("div",{staticClass:"item-name"},[i._v("最近到访时间")])]),i._v(" "),s("Col",{attrs:{span:"4"}},[s("DatePicker",{staticClass:"date-picker-input",attrs:{type:"daterange",placeholder:"选择日期和时间",placement:"bottom-end"},on:{"on-change":i.selectDate},model:{value:i.dateRange,callback:function(t){i.dateRange=t},expression:"dateRange"}})],1)],1)],1)},staticRenderFns:[]}},1304:function(t,e){t.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("div",{staticClass:"add-vip"},[i("p",{staticClass:"customer-list-title"},[e._v("访客列表\n            ")]),e._v(" "),i("appVisitingSearch",{on:{visitSearch:function(t){e.searchVisitors(t)}}}),e._v(" "),i("div",{staticClass:"customer-list-content"},[i("Table",{attrs:{border:"",columns:e.visitColumnTitle,data:e.visitingList}}),e._v(" "),i("p",{staticClass:"page"},[i("Page",{attrs:{current:e.page,total:e.visitingTotal,"show-elevator":"","show-total":"","page-size":e.pageSize},on:{"on-change":e.changePage}})],1)],1),e._v(" "),i("Modal",{attrs:{title:"手动识别访客",width:"480"},model:{value:e.showMergeVisitToCustomerModal,callback:function(t){e.showMergeVisitToCustomerModal=t},expression:"showMergeVisitToCustomerModal"}},[i("div",{staticStyle:{overflow:"hidden"}},[i("div",{staticClass:"current-visit-modal-head"},[i("Avatar",{attrs:{src:e.currentVisit.visitCapture,size:"large",width:"100px"}}),e._v(" "),i("p",[e._v("访客ID: "+e._s(e.currentVisit.visitId))])],1),e._v(" "),i("div",{staticStyle:{float:"right"}},[i("Table",{attrs:{border:"",height:"350",width:"300",columns:e.currentVisit.similarCustomerColumns,data:e.currentVisit.similarOldCustomerList}})],1)]),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"})])],1)])},staticRenderFns:[]}},1403:function(t,e,i){var s=i(304)(i(1298),i(1304),function(t){i(1296)},"data-v-615a60e2",null);t.exports=s.exports},677:function(t,e,i){t.exports={default:i(766),__esModule:!0}},766:function(t,e,i){i(309),i(308),t.exports=i(767)},767:function(t,e,i){var s=i(37),r=i(310);t.exports=i(26).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return s(e.call(t))}},784:function(t,e,i){"use strict";e.__esModule=!0;var s,r=i(789),n=(s=r)&&s.__esModule?s:{default:s};e.default=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return(0,n.default)(t)}},789:function(t,e,i){t.exports={default:i(790),__esModule:!0}},790:function(t,e,i){i(308),i(791),t.exports=i(26).Array.from},791:function(t,e,i){"use strict";var m=i(62),s=i(49),p=i(125),v=i(314),g=i(315),h=i(128),f=i(792),C=i(310);s(s.S+s.F*!i(316)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,s,r,n=p(t),a="function"==typeof this?this:Array,o=arguments.length,u=1<o?arguments[1]:void 0,c=void 0!==u,l=0,d=C(n);if(c&&(u=m(u,2<o?arguments[2]:void 0,2)),null==d||a==Array&&g(d))for(i=new a(e=h(n.length));l<e;l++)f(i,l,c?u(n[l],l):n[l]);else for(r=d.call(n),i=new a;!(s=r.next()).done;l++)f(i,l,c?v(r,u,[s.value,l],!0):s.value);return i.length=l,i}})},792:function(t,e,i){"use strict";var s=i(56),r=i(127);t.exports=function(t,e,i){e in t?s.f(t,e,r(0,i)):t[e]=i}},884:function(t,u,p){"use strict";(function(c){u.a=function(t,e){return i.a.apply(Object,[{}].concat(s()(e)))},p.d(u,"b",function(){return o});var t=p(317),i=p.n(t),e=p(784),s=p.n(e),r=p(677),l=p.n(r),n=p(318),d=p.n(n),a=p(84),m=p.n(a);var o={orsearch:function(t,e){var i=[];if(c.isEmpty(e))return{};var s=!0,r=!1,n=void 0;try{for(var a,o=l()(e);!(s=(a=o.next()).done);s=!0){var u=a.value;i.push({eq:u})}}catch(t){r=!0,n=t}finally{try{!s&&o.return&&o.return()}finally{if(r)throw n}}return d()({},t,m()(i))},equalsearch:function(t,e){return c.isEmpty(e)?{}:d()({},t,e)},rangesearch:function(t,e){if(c.isEmpty(e))return{};var i=e[0],s=e[1];return d()({},t,m()({gt:i,lt:s}))}}}).call(u,p(123))}});