webpackJsonp([34],{1317:function(e,t,i){var s=i(1318);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i(590)("4ca5ec56",s,!0,{})},1318:function(e,t,i){(e.exports=i(589)()).push([e.i,".creat-department .creat-new-department-title[data-v-401dd738]{height:50px;line-height:50px;padding-left:30px;border-bottom:1px solid #DDD;font-size:16px}.creat-department .creat-department-content[data-v-401dd738]{padding-bottom:30px;overflow:hidden}.creat-department .creat-new-department[data-v-401dd738]{width:38%;float:left;margin-right:2%;border:1px solid #DDD;min-height:652px}.creat-department .creat-new-department .ivu-form.ivu-form-label-right[data-v-401dd738]{width:90%;margin:30px auto}.creat-department .creat-new-department .creat-new-department-title[data-v-401dd738]{height:40px;line-height:40px;padding-left:15px;background-color:#F2F2F5;font-size:14px}.creat-department .creat-new-department .department-name[data-v-401dd738]{height:50px;line-height:50px;text-align:center;margin-top:20px}.creat-department .creat-new-department .department-name span[data-v-401dd738]{width:80px;height:50px;line-height:50px;display:inline-block;font-size:12px}.creat-department .creat-new-department .department-name .ivu-input-wrapper[data-v-401dd738]{width:50%}.creat-department .setting-permission[data-v-401dd738]{width:60%;float:left;border:1px solid #DDD;min-height:652px}.creat-department .setting-permission .setting-permission-title[data-v-401dd738]{height:40px;line-height:40px;padding-left:15px;background-color:#F2F2F5;font-size:14px}.creat-department .setting-permission .setting-permission-content[data-v-401dd738]{padding:30px}.creat-department .setting-permission .store-permission[data-v-401dd738]{margin-bottom:20px}.creat-department .setting-permission .permission[data-v-401dd738]{height:260px;border:1px solid #DDD;overflow:auto;scrollbar-face-color:#DDD;scrollbar-highlight-color:#09C}.creat-department .setting-permission .permission[data-v-401dd738]::-webkit-scrollbar{background-color:#DDD;width:3px}.creat-department .setting-permission .permission[data-v-401dd738]::-webkit-scrollbar-thumb{background-color:#09C;border-radius:2px}.creat-department .setting-permission .setting-permission-content .title[data-v-401dd738]{height:50px;line-height:50px;padding-left:15px;font-size:14px}.creat-department .setting-permission .data-center[data-v-401dd738]{padding:0 30px 30px}.creat-department .setting-permission .severed[data-v-401dd738]{height:1px;margin-left:50px;background-color:#DDD;margin-top:10px;margin-bottom:10px}.creat-department .setting-permission .ivu-checkbox-group[data-v-401dd738]{padding-left:40px}.creat-department .setting-permission .operation-analyze[data-v-401dd738]{margin-top:40px}.creat-department .operation-button[data-v-401dd738]{height:50px;line-height:50px;text-align:center;margin-bottom:40px}.creat-department .operation-button .ivu-btn.ivu-btn-primary[data-v-401dd738]{margin-right:30px}.creat-department .ivu-checkbox-checked .ivu-checkbox-inner[data-v-401dd738]{border-color:#0098CA;background-color:#0098CA}label.ivu-checkbox-wrapper-disabled[data-v-401dd738]{pointer-events:none!important}",""])},1319:function(e,o,d){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),function(e){var t=d(305),n=d.n(t),i=d(306),r=d.n(i),a=d(307),s=d(834);o.default={mixins:[s.a],data:function(){return{departmentEdited:{},allDepartments:[],positionEdited:{},allManagerPermissionsId:[],allStorePermissionsId:[],ifselected:!0,ifCreatPosition:!0,ifCreatDepartment:!0,ifDepartment:!1,departmentName:"",position:{departmentIdAttached:"",name:"",desc:""},allInitPermissions:[],ruleValidate:{name:[{required:!0,message:"岗位不能为空",trigger:"blur"}],departmentIdAttached:[{required:!0}]}}},mounted:function(){"creatDepartment"===this.$route.params.type&&this.receiveCreatDepartment(),"editDepartment"===this.$route.params.type&&this.receiveEditDepartment(),"creatPosition"===this.$route.params.type&&this.receiveCreatPosition(),"editPosition"===this.$route.params.type&&this.receiveEditPosition()},methods:{receiveCreatDepartment:function(){"creatDepartment"===this.$route.params.type&&(this.ifDepartment=!0,this.ifCreatDepartment=!0,this.allInitPermissions=this.$route.params.allInitPermissions,this.classifyAllInitPermissions())},receiveEditDepartment:function(){"editDepartment"===this.$route.params.type&&(this.ifDepartment=!0,this.ifCreatDepartment=!1,e.isEmpty(this.$route.params.departmentEdited)||(this.departmentEdited=this.$route.params.departmentEdited),this.allInitPermissions=this.$route.params.allInitPermissions,this.classifyAllInitPermissions(),this.formatDepartmentEditedPermissions(),this.renderCheckboxState())},receiveCreatPosition:function(){this.ifDepartment=!1,this.ifCreatPosition=!0,this.allDepartments=this.$route.params.allDepartments,this.allInitPermissions=this.$route.params.allInitPermissions,this.classifyAllInitPermissions(),this.position.departmentIdAttached=this.allDepartments[0].id,this.selectDepartment(this.allDepartments[0])},receiveEditPosition:function(){var t=this;"editPosition"===this.$route.params.type&&(this.ifDepartment=!1,this.ifCreatPosition=!1,this.$route.params.allDepartments&&(this.allDepartments=this.$route.params.allDepartments,this.allInitPermissions=this.$route.params.allInitPermissions),e.isEmpty(this.$route.params.positionEdited)||(this.positionEdited=this.$route.params.positionEdited),this.position.departmentIdAttached=this.positionEdited.departmentAttached.id,this.position.name=this.positionEdited.name,this.position.desc=this.positionEdited.description,this.allInitPermissions=this.$route.params.allInitPermissions,this.allDepartments=this.$route.params.allDepartments,this.classifyAllInitPermissions(),this.formatPositionPermissions(),this.allDepartments.forEach(function(e){e.id===t.positionEdited.departmentAttached.id&&t.selectDepartment(e)}))},selectDepartment:function(e){this.resetAllInitPermissions(),this.allInitPermissions.forEach(function(e){e.disabled=!0,e.functions.forEach(function(e){e.disabled=!0})}),this.extendPermissionsOfDepartmentSelected(e),this.getCheckboxAbledCounts(),this.renderCheckboxState()},resetAllInitPermissions:function(){this.allInitPermissions.forEach(function(e){e.checkAll=!1,e.disabled=!1,e.indeterminate=!1,e.permissionIds=[],e.checkboxAbledCount=0,e.functions.forEach(function(e){e.selected=!1,e.disabled=!1})})},classifyAllInitPermissions:function(){var i=[],s=[];this.allInitPermissions.forEach(function(t){t.functions.forEach(function(e){"1"===t.type?i.push(e.id):s.push(e.id)})}),this.allManagerPermissionsId=i,this.allStorePermissionsId=s},formatDepartmentEditedPermissions:function(){var i=this;this.allInitPermissions.forEach(function(e){var t=[];e.functions.forEach(function(e){i.departmentEdited.totalPermissions.length&&i.departmentEdited.totalPermissions.includes(e.id)&&(e.selected=!0,t.push(e.id))}),e.permissionIds=t})},formatPositionPermissions:function(){var s=this;this.allInitPermissions.forEach(function(e){var i=[];e.functions.forEach(function(t){s.positionEdited.permissions.length&&s.positionEdited.permissions.forEach(function(e){e===t.id&&(t.selected=!0,i.push(e))})}),e.permissionIds=i})},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},save:function(){var t=this,i=[],s=[];this.allInitPermissions.forEach(function(e){e.permissionIds.forEach(function(e){t.allManagerPermissionsId.includes(e)&&i.push(e),t.allStorePermissionsId.includes(e)&&s.push(e)})});var e={management:i,stores:s};this.ifDepartment?this.ifCreatDepartment&&0<this.trim(this.departmentName).length?this.sendCreatDepartmentRequest(e):!this.ifCreatDepartment&&0<this.trim(this.departmentEdited.name).length?this.sendEditDepartmentRequest(e):this.$Notice.warning({title:"部门操作",desc:"部门名称不能为空"}):0<this.trim(this.position.name).length?this.ifCreatPosition?this.sendCreatPositionRequest(e):this.sendEditPositionRequest(e):this.$Notice.warning({title:"岗位操作",desc:"岗位和部门不能为空"})},sendCreatDepartmentRequest:function(i){var s=this;return r()(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.l(s.departmentName,i);case 2:(t=e.sent)&&200===t.code?(s.$Message.success("添加部门成功！"),s.$router.push({name:"department"})):s.$Message.error("添加部门失败！");case 4:case"end":return e.stop()}},e,s)}))()},sendEditDepartmentRequest:function(i){var s=this;return r()(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a._52(s.departmentEdited.id,s.departmentEdited.name,i);case 2:(t=e.sent)&&200===t.code?(s.$Message.success("修改部门成功！"),s.$router.push({name:"department"})):s.$Message.error("修改部门失败！");case 4:case"end":return e.stop()}},e,s)}))()},sendCreatPositionRequest:function(i){var s=this;return r()(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.n(s.position.departmentIdAttached,s.position.name,i,s.position.desc);case 2:(t=e.sent)&&200===t.code?(s.$Message.success("创建岗位成功！"),s.$router.push({name:"position"})):s.$Message.error("创建岗位失败！");case 4:case"end":return e.stop()}},e,s)}))()},sendEditPositionRequest:function(i){var s=this;return r()(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a._58(s.position.departmentIdAttached,s.positionEdited.id,s.position.name,i,s.position.desc);case 2:(t=e.sent)&&200===t.code?(s.$Message.success("修改岗位成功！"),s.$router.push({name:"position"})):s.$Message.error("修改岗位失败！");case 4:case"end":return e.stop()}},e,s)}))()},cancelSaveDepartment:function(){this.ifDepartment?this.$router.push({name:"department"}):this.$router.push({name:"position"})},handleCheckAll:function(t){this.ifselected=!1,t.checkAll=!t.checkAll,t.indeterminate=!1,t.disabled||(t.checkAll?(t.permissionIds=[],t.functions.forEach(function(e){e.disabled||(e.selected=!0,t.permissionIds.push(e.id))})):(t.permissionIds=[],t.functions.forEach(function(e){e.disabled||(e.selected=!1)}))),this.renderCheckboxState(),this.ifselected=!0},handleCheckSingle:function(e,t){this.ifselected=!1;var i=e.permissionIds.indexOf(t.id);-1!==i?(t.selected=!1,e.permissionIds.splice(i,1)):(t.selected=!0,e.permissionIds.push(t.id)),e.permissionIds.length===e.checkboxAbledCount?e.checkAll=!0:e.checkAll=!1,0<e.permissionIds.length&&e.permissionIds.length<e.checkboxAbledCount?e.indeterminate=!0:e.indeterminate=!1,this.renderCheckboxState(),this.ifselected=!0}}}}.call(o,d(123))},1320:function(e,t){e.exports={render:function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"creat-department"},[n("div",{staticClass:"creat-department-content"},[s.ifDepartment?n("div",{staticClass:"creat-new-department"},[s.ifCreatDepartment?n("p",{staticClass:"creat-new-department-title PingFangSC-Medium-font"},[s._v("新建部门")]):n("p",{staticClass:"creat-new-department-title PingFangSC-Medium-font"},[s._v("修改部门")]),s._v(" "),s.ifCreatDepartment?n("p",{staticClass:"department-name"},[n("span",[s._v("部门名称：")]),n("Input",{attrs:{placeholder:"请输入部门名称"},model:{value:s.departmentName,callback:function(e){s.departmentName=e},expression:"departmentName"}})],1):n("p",{staticClass:"department-name"},[n("span",[s._v("部门名称：")]),n("Input",{attrs:{placeholder:"请输入部门名称"},model:{value:s.departmentEdited.name,callback:function(e){s.$set(s.departmentEdited,"name",e)},expression:"departmentEdited.name"}})],1)]):n("div",{staticClass:"creat-new-department"},[s.ifCreatPosition?n("p",{staticClass:"creat-new-department-title PingFangSC-Medium-font"},[s._v("新建自定义岗位")]):n("p",{staticClass:"creat-new-department-title PingFangSC-Medium-font"},[s._v("修改岗位")]),s._v(" "),n("Form",{ref:"position",attrs:{model:s.position,rules:s.ruleValidate,"label-width":100}},[n("FormItem",{attrs:{label:"选择部门：",prop:"department"}},[n("Select",{attrs:{placeholder:"请选择部门",disabled:!s.ifCreatPosition},model:{value:s.position.departmentIdAttached,callback:function(e){s.$set(s.position,"departmentIdAttached",e)},expression:"position.departmentIdAttached"}},s._l(s.allDepartments,function(t,e){return n("Option",{key:e,attrs:{value:t.id},nativeOn:{click:function(e){e.preventDefault(),s.selectDepartment(t)}}},[s._v("\n                            "+s._s(t.name)+"\n                        ")])}))],1),s._v(" "),n("FormItem",{attrs:{label:"岗位名称：",prop:"job"}},[n("Input",{attrs:{placeholder:"请输入岗位名称"},model:{value:s.position.name,callback:function(e){s.$set(s.position,"name",e)},expression:"position.name"}})],1),s._v(" "),n("FormItem",{attrs:{label:"岗位描述：",prop:"desc"}},[n("Input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"请输入..."},model:{value:s.position.desc,callback:function(e){s.$set(s.position,"desc",e)},expression:"position.desc"}})],1)],1)],1),s._v(" "),n("div",{staticClass:"setting-permission"},[n("p",{staticClass:"setting-permission-title PingFangSC-Medium-font"},[s._v("权限设置")]),s._v(" "),n("div",{staticClass:"setting-permission-content"},[n("div",{staticClass:"store-permission permission"},[n("p",{staticClass:"title"},[s._v("店铺权限")]),s._v(" "),s._l(s.allInitPermissions,function(i,e){return"0"===i.type?n("div",{key:e,staticClass:"data-center"},[n("div",{directives:[{name:"show",rawName:"v-show",value:s.ifselected,expression:"ifselected"}]},[n("Checkbox",{attrs:{indeterminate:i.indeterminate,value:i.checkAll,disabled:i.disabled},nativeOn:{click:function(e){e.preventDefault(),s.handleCheckAll(i)}}},[s._v("\n                                "+s._s(i.func_group_name)+"\n                            ")]),s._v(" "),n("p",{staticClass:"severed"}),s._v(" "),n("CheckboxGroup",{model:{value:i.permissionIds,callback:function(e){s.$set(i,"permissionIds",e)},expression:"permissionGroup.permissionIds"}},s._l(i.functions,function(t,e){return n("Checkbox",{key:e,attrs:{value:t.selected,label:t.id,disabled:t.disabled},nativeOn:{click:function(e){e.preventDefault(),s.handleCheckSingle(i,t)}}},[s._v("\n                                    "+s._s(t.func_name)+"\n                                ")])}))],1)]):s._e()})],2),s._v(" "),n("div",{staticClass:"administrator-permission permission"},[n("p",{staticClass:"title"},[s._v("管理员权限")]),s._v(" "),s._l(s.allInitPermissions,function(i,e){return"1"===i.type?n("div",{key:e,staticClass:"data-center"},[n("div",{directives:[{name:"show",rawName:"v-show",value:s.ifselected,expression:"ifselected"}]},[n("Checkbox",{attrs:{indeterminate:i.indeterminate,value:i.checkAll,disabled:i.disabled},nativeOn:{click:function(e){e.preventDefault(),s.handleCheckAll(i)}}},[s._v("\n                                "+s._s(i.func_group_name)+"\n                            ")]),s._v(" "),n("p",{staticClass:"severed"}),s._v(" "),n("CheckboxGroup",{model:{value:i.permissionIds,callback:function(e){s.$set(i,"permissionIds",e)},expression:"permissionGroup.permissionIds"}},s._l(i.functions,function(t,e){return n("Checkbox",{key:e,attrs:{value:t.selected,label:t.id,disabled:t.disabled},nativeOn:{click:function(e){e.preventDefault(),s.handleCheckSingle(i,t)}}},[s._v("\n                                    "+s._s(t.func_name)+"\n                                ")])}))],1)]):s._e()})],2)])])]),s._v(" "),n("p",{staticClass:"operation-button"},[n("Button",{attrs:{type:"primary"},on:{click:s.save}},[s._v("保存")]),s._v(" "),n("Button",{attrs:{type:"ghost"},on:{click:s.cancelSaveDepartment}},[s._v("取消")])],1)])},staticRenderFns:[]}},1407:function(e,t,i){var s=i(304)(i(1319),i(1320),function(e){i(1317)},"data-v-401dd738",null);e.exports=s.exports},834:function(e,t,i){"use strict";(function(r){t.a={methods:{getCheckboxAbledCounts:function(){this.allInitPermissions.forEach(function(t){t.functions.forEach(function(e){e.disabled||(t.checkboxAbledCount+=1)})})},formatAllInitPermissions:function(){this.allInitPermissions.forEach(function(e){e.checkAll=!1,e.disabled=!1,e.indeterminate=!1,e.permissionIds=[],e.checkboxAbledCount=0,e.functions.forEach(function(e){e.selected=!1,e.disabled=!1})})},getAllStoresFromAreaSelected:function(t){this.allStoresFromAreaSelected=this.allInitStores.find(function(e){return e.title===t[0].title})},updateStoresSelectedCheckboxState:function(){var t=this;this.allStoresFromAreaSelected.storeGroupIds=[],this.allStoresIdListSelected.length?this.allStoresFromAreaSelected.stores.forEach(function(e){t.allStoresIdListSelected.includes(e.store_id)?(e.selected=!0,t.allStoresFromAreaSelected.storeGroupIds.push(e.store_id),t.allStoresFromAreaSelected.stores.every(function(e){return t.allStoresIdListSelected.includes(e.store_id)})&&t.allStoresFromAreaSelected.stores.length===t.allStoresFromAreaSelected.storeGroupIds.length?(t.allStoresFromAreaSelected.checkAll=!0,t.allStoresFromAreaSelected.indeterminate=!1):(t.allStoresFromAreaSelected.checkAll=!1,t.allStoresFromAreaSelected.indeterminate=!0)):(e.selected=!1,t.allStoresFromAreaSelected.checkAll=!1)}):(this.allStoresFromAreaSelected.checkAll=!1,this.allStoresFromAreaSelected.indeterminate=!1)},next:function(){var s=this;this.allStoresSelected.length?(this.openAddStoresModal=!1,this.openAddStorePermissionsModal=!0,this.employeeEdited.storesOfPermissionsAdded=[],this.allStoresSelected.forEach(function(t){var e=[];if(s.employeeEdited.storesManaged.length){var i=r.find(s.employeeEdited.storesManaged,function(e){return e.store_id===t.store_id});e=void 0!==i?i.permissionsSelected:s.employeeEdited.store_permissions}s.employeeEdited.storesOfPermissionsAdded.push({store_name:t.sotre_name,store_id:t.store_id,store_permissions:s.employeeEdited.store_permissions,permissionsSelected:r.cloneDeep(e)})}),this.selectStore(this.employeeEdited.storesOfPermissionsAdded[0].store_id)):this.$Notice.warning({title:"添加店铺",desc:"请先添加店铺"})},selectStore:function(t){this.ifselected=!1,this.storeIdSelected=t;var e=this.employeeEdited.storesOfPermissionsAdded.find(function(e){return e.store_id===t});this.resetAllInitPermissions(),this.allInitPermissions.forEach(function(e){e.disabled=!0,e.functions.forEach(function(e){e.disabled=!0})}),this.extendPermissionsOfPositionSelected(e),this.getCheckboxAbledCounts(),this.renderCheckboxState(),this.ifselected=!0},resetAllInitPermissions:function(){r.each(this.allInitPermissions,function(e){e.checkAll=!1,e.disabled=!1,e.indeterminate=!1,e.permissionIds=[],e.checkboxAbledCount=0,r.each(e.functions,function(e){e.selected=!1,e.disabled=!1})})},extendPermissionsOfPositionSelected:function(e){r.each(this.allInitPermissions,function(i){r.each(i.functions,function(t){r.each(e.store_permissions,function(e){t.id===e&&(t.disabled=!1)}),r.each(e.permissionsSelected,function(e){t.id===e&&(t.selected=!0,i.permissionIds.push(t.id))})})})},renderCheckboxState:function(){this.allInitPermissions.forEach(function(e){0!==e.checkboxAbledCount?e.permissionIds.length===e.checkboxAbledCount?(e.indeterminate=!1,e.disabled=!1,e.checkAll=!0):0<e.permissionIds.length&&e.permissionIds.length<e.checkboxAbledCount?(e.indeterminate=!0,e.disabled=!1):(e.disabled=!1,e.indeterminate=!1):(e.disabled=!0,e.checkAll=!1)})},extendPermissionsOfDepartmentSelected:function(s){var n=this;this.allInitPermissions.forEach(function(i){i.functions.forEach(function(e){if(s.totalPermissions.length){var t=[];r.isEmpty(n.positionEdited)?(t=s.totalPermissions).includes(e.id)&&(e.disabled=!1,e.selected=!0,i.permissionIds.push(e.id)):(t=r.intersection(s.totalPermissions,n.positionEdited.permissions),s.totalPermissions.includes(e.id)&&(e.disabled=!1),t.includes(e.id)&&(e.selected=!0,i.permissionIds.push(e.id)))}})})}}}}).call(t,i(123))}});