webpackJsonp([20],{1297:function(t,e,i){var n=i(1298);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i(589)("7eed9f87",n,!1,{})},1298:function(t,e,i){(t.exports=i(588)()).push([t.i,"\n.customer-list-title[data-v-615a60e2] {\n    height: 50px;\n    line-height: 50px;\n    font-size: 16px;\n    padding-left: 30px;\n    border-bottom: 1px solid #DDD;\n}\n.customer-list-content[data-v-615a60e2] {\n    padding: 35px;\n}\n.customer-list-content .page[data-v-615a60e2] {\n    height: 100px;\n    position: relative;\n}\n.customer-list-content .page ul.ivu-page[data-v-615a60e2] {\n    position: absolute;\n    top: 35px;\n    right: 0;\n}\n.ivu-table .demo-table-vip-row td[data-v-615a60e2] {\n    background-color: #FFF5E4;\n}\n.add-new-clerk-base-info-content-avatar img[data-v-615a60e2] {\n    margin-left: 30px;\n}\n.similar-costomer-img-content img[data-v-615a60e2] {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.current-visit-modal-head[data-v-615a60e2] {\n    float: left;\n    margin-top: 100px;\n    margin-bottom: 20px;\n}\n.current-visit-modal-head p[data-v-615a60e2] {\n    height: 30px;\n    line-height: 30px;\n    text-align: center;\n    font-weight: bold;\n    font-size: 14px;\n}\n.current-visit-modal-table[data-v-615a60e2] {\n    float: right;\n}\n\n",""])},1299:function(t,h,g){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),function(n){var t,e,i=g(305),s=g.n(i),r=g(306),a=g.n(r),o=g(307),u=g(82),c=g(121),l=g(1300),d=g.n(l),m=g(883),p=g(1),v=g.n(p);h.default={created:function(){this.setVisitColumnTitles()},data:function(){return{visitDisabled:!1,showDbResetModal:!1,visitingData:{},pageSize:10,visitingTotal:0,visitingCustomerList:[],timerGetVisitingCustomer:{refreshTime:5e3,timer:null},page:1,showMergeVisitToCustomerModal:!1,currentVisit:{similarCustomerColumns:[],visitId:null,visitCapture:"",similarOldCustomerList:[],threshold:1.5},isEmitSearch:!1,visitColumnTitle:[],searchCondition:[],searchConditionObject:{},itemFunctionMapping:{name:m.b.equalsearch,gender:m.b.equalsearch,age:m.b.orsearch,visit_time:m.b.rangesearch,important_level:m.b.orsearch},utcDateRange:[]}},computed:{visitingList:function(){return n.isEmpty(this.visitingCustomerList)?[]:n.map(this.visitingCustomerList,this.formatVisit)}},components:{appVisitingSearch:d.a},watch:{"visitingData.total":{handler:"updateVistingCustomers",deep:!0}},sockets:{similarities_cus_by_visit:function(t){if(t){var e=JSON.parse(t);for(var i in e){var n=e[i];n.customerId=n.id,n.customerCapture=c.a.appendPrefixStaticUrl(n.customer_capture)}this.currentVisit.similarOldCustomerList=e,this.currentVisit.similarOldCustomerList.sort(function(t,e){return t.difference-e.difference})}}},mounted:function(){var t=this;this.getStoreStatus(),this.$store.dispatch("loadStateList").then(function(){t.visitingCustomerList=[],clearInterval(u.a.timerGetVisitingCustomer),t.getVisitingCustomers(),t.timerGetVisitingCustomer.timer=setInterval(t.getVisitingCustomers,t.timerGetVisitingCustomer.refreshTime)}),this.appendSimilarCustomerColumns()},beforeDestroy:function(){clearInterval(this.timerGetVisitingCustomer.timer)},methods:{getStoreStatus:function(){var i=this;return a()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o._23();case 2:(e=t.sent)&&200===e.code&&(i.visitDisabled=!e.data.store_status,e.data.store_status||i.$Message.warning("店铺处于离线状态"));case 4:case"end":return t.stop()}},t,i)}))()},changePage:(e=a()(s.a.mark(function t(e){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return clearInterval(this.timerGetVisitingCustomer.timer),this.page=e,this.visitingCustomerList=[],t.next=5,this.getVisitingCustomers(this.searchCondition);case 5:this.updateVistingCustomers(),this.isDefault(this.searchCondition)&&(this.timerGetVisitingCustomer.timer=setInterval(this.getVisitingCustomers,this.timerGetVisitingCustomer.refreshTime),this.isEmitSearch=!1,this.searchCondition=[],this.searchConditionObject={});case 7:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)}),formatVisit:function(t){var e={};return e.customer_id=t.customer_id,e.local_visit_id=t.local_visit_id,e.visitCapture=c.a.appendPrefixStaticUrl(t.snapshot_uri),e.customerCapture=c.a.appendPrefixStaticUrl(t.customer_capture),e.inDate=c.a.utcToDate(t.visit_time),e.inTime=c.a.utcToTime(t.visit_time),e.name=t.name?t.name:"未设置",e.age=this.$store.getters.getAgeTextByValue(t.age),e.gender=this.$store.getters.getGenderTextByValue(t.gender),e.customerType=this.$store.getters.getCustomerTypeTextByValue(t.important_level),e},updateVistingCustomers:function(){this.visitingTotal=this.visitingData.total,this.pageSize=this.visitingData.items_num;var t=this.visitingData.visits,e=this.getNewVisits(t);n.isEmpty(e)?this.visitTableLoading=!1:(this.isEmitSearch&&(this.visitingCustomerList=[]),this.visitingCustomerList=n.concat(this.visitingCustomerList,e))},getNewVisits:function(t){var i=this;return n.filter(t,function(e){return-1===n.findIndex(i.visitingCustomerList,function(t){return t.id===e.id})})},searchVisitors:function(t){this.searchCondition=t,this.page=1,clearInterval(this.timerGetVisitingCustomer.timer),this.isEmitSearch=!0,this.visitingCustomerList=[],this.isDefault(this.searchCondition)&&(this.timerGetVisitingCustomer.timer=setInterval(this.getVisitingCustomers,this.timerGetVisitingCustomer.refreshTime),this.isEmitSearch=!1,this.searchCondition=[]),this.getVisitingCustomers(this.searchCondition)},isDefault:function(t){if(n.isEmpty(t))return!0;var e=!0;return e=(e=(e=(e=(e=(e=e&&n.isEmpty(t.name))&&n.isEmpty(t.gender))&&n.isEmpty(t.age))&&n.isEmpty(t.important_level))&&c.a.isEqualDay(c.a.getMomentByUtc(t.visit_time[0]),v()()))&&c.a.isEqualDay(c.a.getMomentByUtc(t.visit_time[1]),v()().add(1,"days"))},getVisitingCustomers:(t=a()(s.a.mark(function t(){var e,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o._50(this.page,this.getSearchConditionObject(i));case 2:(e=t.sent)&&200===e.code&&(this.visitingData=e.data);case 4:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)}),getSearchConditionObject:function(t){if(n.isEmpty(t))return{};var e=[];for(var i in t)e.push(this.itemFunctionMapping[i](i,t[i]));return e=Object(m.a)(this.itemFunctionMapping,e)},addVisitToNewCustomer:function(i){var n=this;return a()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.f(Number(i.visitId));case 2:(e=t.sent)&&200===e.code?(n.$Message.success("成功添加为顾客"),n.changePage(n.page)):n.$Message.warning("店铺处于离线状态");case 4:case"end":return t.stop()}},t,n)}))()},deleteVisit:function(i){var n=this;return a()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.E(Number(i.visitId));case 2:(e=t.sent)&&200===e.code&&(n.visitingCustomerList=[],n.$Message.success("删除顾客成功"),n.getVisitingCustomers());case 4:case"end":return t.stop()}},t,n)}))()},mergeVisitToOldCustomer:function(i){var n=this;return a()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.showMergeVisitToCustomerModal=!0,n.currentVisit.visitId=i.visitId,n.currentVisit.visitCapture=i.visitCapture,n.currentVisit.selectedMergeOldCustomerId=i.customerId,n.currentVisit.similarOldCustomerList=[],t.next=7,o._18(n.currentVisit.visitId,n.currentVisit.threshold);case 7:(e=t.sent)&&200===e.code||n.$Message.warning("店铺处于离线状态");case 9:case"end":return t.stop()}},t,n)}))()},appendSimilarCustomerColumns:function(){var i=this;this.currentVisit.similarCustomerColumns=[{title:"顾客ID",key:"customer_id",align:"center",width:80},{title:"顾客头像",key:"visitCapture",align:"center",render:function(t,e){return t("div",[t("Avatar",{props:{src:e.row.customerCapture,size:"large"}})])}},{title:"操作",key:"action",width:80,align:"center",render:function(t,e){return t("div",[t("Button",{props:{type:"primary",size:"small"},on:{click:function(){i.submitMergeOperation(e.row.customerId)}}},"确定")])}}]},submitMergeOperation:function(i){var n=this;return a()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o._38(n.currentVisit.visitId,i);case 2:(e=t.sent)&&200===e.code&&(n.showMergeVisitToCustomerModal=!1,n.changePage(1));case 4:case"end":return t.stop()}},t,n)}))()},setVisitColumnTitles:function(){this.visitColumnTitle=[{title:"访客ID",key:"local_visit_id",align:"center",width:80},{title:"顾客ID",key:"customer_id",align:"center",width:140,render:function(t,e){return t("div",[t("p",{},e.row.customerId),t("p",[t("Avatar",{props:{src:e.row.customerCapture,size:"large"}})])])}},{title:"访客头像",width:140,key:"visitCapture",align:"center",render:function(t,e){return t("div",[t("Avatar",{props:{src:e.row.visitCapture,size:"large"}})])}},{title:"姓名",key:"name",align:"center"},{title:"到访时间",key:"inTime",align:"center",render:function(t,e){return t("div",[t("p",{},e.row.inDate),t("p",{},e.row.inTime)])}},{title:"性别",key:"gender",align:"center"},{title:"年龄段",key:"age",align:"center"},{title:"顾客类型",key:"customerType",align:"center"}]}}}}.call(h,g(122))},1300:function(t,e,i){var n=!1;var s=i(304)(i(1303),i(1304),function(t){n||i(1301)},"data-v-363e2f2a",null);s.options.__file="/Users/zhouqichao/Desktop/sxkj/shangu_online/src/components/views/CRM/children/visitingSearch.vue",s.esModule&&Object.keys(s.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),s.options.functional&&console.error("[vue-loader] visitingSearch.vue: functional components are not supported with templates, they should use render functions."),t.exports=s.exports},1301:function(t,e,i){var n=i(1302);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i(589)("0b3dc8dd",n,!1,{})},1302:function(t,e,i){(t.exports=i(588)()).push([t.i,"\n.row-grid[data-v-363e2f2a] {\n    margin-bottom: 5px;\n    margin-top: 15px;\n}\n.item-name[data-v-363e2f2a] {\n    text-align: center;\n    margin-left:auto;\n    margin-right:auto;\n    margin-top: 7px;\n}\n.date-picker-input[data-v-363e2f2a] {\n    width: 80%;\n}\n.info-input[data-v-363e2f2a] {\n    width: 80%\n}\n.single-choose[data-v-363e2f2a] {\n    width: 80%\n}\n.multi-choose[data-v-363e2f2a] {\n    width: 80%\n}\n.select-btn[data-v-363e2f2a] {\n    text-align: center;\n}\n",""])},1303:function(t,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),function(n){var t=u(309),e=u.n(t),i=u(312),s=u(1),r=u.n(s),a=u(121);o.default={data:function(){return{name:"",gender:[],age:[],dateRange:["",""],customerType:[]}},computed:e()({},Object(i.c)(["genderList","ageList","customerTypeList","getAgeValueListByValue"]),{utcDateRange:function(){var t=[r()(this.dateRange[0]),r()(this.dateRange[1])];return a.a.timeRangeUtc.apply(a.a,t)}}),methods:e()({},Object(i.b)({loadGenderList:"getGenderListAction",setSelectedGender:"setGender"}),{selectDate:function(t){this.dateRange=t},search:function(){var e=this,t=n.flatten(n.map(this.age,function(t){return e.getAgeValueListByValue(t)})),i={name:this.name,gender:this.gender,age:t,visit_time:this.utcDateRange,important_level:this.customerType};this.dateRange.every(function(t){return""===t})&&delete i.visit_time,this.$emit("visitSearch",i)}}),mounted:function(){}}}.call(o,u(122))},1304:function(t,e,i){t.exports={render:function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("div",[n("Row",{staticClass:"row-grid"},[n("Col",{attrs:{span:"2"}},[n("div",{staticClass:"item-name"},[i._v("姓名")])]),i._v(" "),n("Col",{attrs:{span:"4"}},[n("Input",{staticClass:"info-input",attrs:{disabled:"false",placeholder:"姓名"},on:{"on-enter":i.search},model:{value:i.name,callback:function(t){i.name=t},expression:"name"}})],1),i._v(" "),n("Col",{attrs:{span:"2"}},[n("div",{staticClass:"item-name"},[i._v("性别")])]),i._v(" "),n("Col",{attrs:{span:"4"}},[n("Select",{staticClass:"single-choose",attrs:{placeholder:"性别"},model:{value:i.gender,callback:function(t){i.gender=t},expression:"gender"}},i._l(i.genderList,function(t,e){return n("Option",{key:e,attrs:{value:t.value}},[i._v(i._s(t.text))])}))],1),i._v(" "),n("Col",{attrs:{span:"2"}},[n("div",{staticClass:"item-name"},[i._v("年龄")])]),i._v(" "),n("Col",{attrs:{span:"4"}},[n("Select",{staticClass:"multi-choose",attrs:{multiple:"",placeholder:"年龄段"},model:{value:i.age,callback:function(t){i.age=t},expression:"age"}},i._l(i.ageList,function(t,e){return n("Option",{key:e,attrs:{value:t.value}},[i._v(i._s(t.text))])}))],1),i._v(" "),n("Col",{staticStyle:{"text-align":"center"},attrs:{span:"2"}},[n("Button",{staticClass:"select-btn",attrs:{type:"info",icon:"ios-search"},on:{click:i.search}},[i._v("搜索")])],1)],1),i._v(" "),n("Row",[n("Col",{attrs:{span:"2"}},[n("div",{staticClass:"item-name"},[i._v("顾客类型")])]),i._v(" "),n("Col",{attrs:{span:"4"}},[n("Select",{staticClass:"multi-choose",attrs:{disabled:"false",multiple:"",placeholder:"顾客类型"},model:{value:i.customerType,callback:function(t){i.customerType=t},expression:"customerType"}},i._l(i.customerTypeList,function(t,e){return n("Option",{key:e,attrs:{value:t.value}},[i._v(i._s(t.text))])}))],1),i._v(" "),n("Col",{attrs:{span:"2"}},[n("div",{staticClass:"item-name"},[i._v("最近到访时间")])]),i._v(" "),n("Col",{attrs:{span:"4"}},[n("Date-picker",{staticClass:"date-picker-input",attrs:{type:"daterange",placeholder:"选择日期和时间",placement:"bottom-end",clearable:!1},on:{"on-change":i.selectDate},model:{value:i.dateRange,callback:function(t){i.dateRange=t},expression:"dateRange"}})],1)],1)],1)},staticRenderFns:[]},t.exports.render._withStripped=!0},1305:function(t,e,i){t.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("div",{staticClass:"add-vip"},[i("p",{staticClass:"customer-list-title"},[e._v("访客列表\n            ")]),e._v(" "),i("div",{staticClass:"margin-left: auto;margin-right: auto;"},[i("appVisitingSearch",{on:{visitSearch:function(t){e.searchVisitors(t)}}})],1),e._v(" "),i("div",{staticClass:"customer-list-content"},[i("Table",{attrs:{border:"",columns:e.visitColumnTitle,data:e.visitingList}}),e._v(" "),i("p",{staticClass:"page"},[i("Page",{attrs:{current:e.page,total:e.visitingTotal,"show-elevator":"","show-total":"","page-size":e.pageSize},on:{"on-change":e.changePage}})],1)],1),e._v(" "),i("Modal",{attrs:{title:"手动识别访客",width:"480"},model:{value:e.showMergeVisitToCustomerModal,callback:function(t){e.showMergeVisitToCustomerModal=t},expression:"showMergeVisitToCustomerModal"}},[i("div",{staticStyle:{overflow:"hidden"}},[i("div",{staticClass:"current-visit-modal-head"},[i("Avatar",{attrs:{src:e.currentVisit.visitCapture,size:"large",width:"100px"}}),e._v(" "),i("p",[e._v("访客ID: "+e._s(e.currentVisit.visitId))])],1),e._v(" "),i("div",{staticStyle:{float:"right"}},[i("Table",{attrs:{border:"",height:"350",width:"300",columns:e.currentVisit.similarCustomerColumns,data:e.currentVisit.similarOldCustomerList}})],1)]),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"})])],1)])},staticRenderFns:[]},t.exports.render._withStripped=!0},1404:function(t,e,i){var n=!1;var s=i(304)(i(1299),i(1305),function(t){n||i(1297)},"data-v-615a60e2",null);s.options.__file="/Users/zhouqichao/Desktop/sxkj/shangu_online/src/components/views/CRM/children/visiting.vue",s.esModule&&Object.keys(s.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),s.options.functional&&console.error("[vue-loader] visiting.vue: functional components are not supported with templates, they should use render functions."),t.exports=s.exports},764:function(t,e,i){t.exports={default:i(765),__esModule:!0}},765:function(t,e,i){i(311),i(308),t.exports=i(766)},766:function(t,e,i){var n=i(36),s=i(310);t.exports=i(31).getIterator=function(t){var e=s(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},783:function(t,e,i){"use strict";e.__esModule=!0;var n,s=i(784),r=(n=s)&&n.__esModule?n:{default:n};e.default=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return(0,r.default)(t)}},784:function(t,e,i){t.exports={default:i(785),__esModule:!0}},785:function(t,e,i){i(308),i(786),t.exports=i(31).Array.from},786:function(t,e,i){"use strict";var m=i(62),n=i(49),p=i(124),v=i(314),h=i(315),g=i(127),f=i(787),C=i(310);n(n.S+n.F*!i(316)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,n,s,r=p(t),a="function"==typeof this?this:Array,o=arguments.length,u=1<o?arguments[1]:void 0,c=void 0!==u,l=0,d=C(r);if(c&&(u=m(u,2<o?arguments[2]:void 0,2)),null==d||a==Array&&h(d))for(i=new a(e=g(r.length));l<e;l++)f(i,l,c?u(r[l],l):r[l]);else for(s=d.call(r),i=new a;!(n=s.next()).done;l++)f(i,l,c?v(s,u,[n.value,l],!0):n.value);return i.length=l,i}})},787:function(t,e,i){"use strict";var n=i(56),s=i(126);t.exports=function(t,e,i){e in t?n.f(t,e,s(0,i)):t[e]=i}},883:function(t,e,i){"use strict";e.a=function(t,e){return s.a.apply(Object,[{}].concat(a()(e)))},i.d(e,"b",function(){return h});var n=i(317),s=i.n(n),r=i(783),a=i.n(r),o=i(764),c=i.n(o),u=i(318),l=i.n(u),d=i(83),m=i.n(d),p=i(122),v=i.n(p);var h={orsearch:function(t,e){var i=[];if(v.a.isEmpty(e))return{};var n=!0,s=!1,r=void 0;try{for(var a,o=c()(e);!(n=(a=o.next()).done);n=!0){var u=a.value;i.push({eq:u})}}catch(t){s=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}return l()({},t,m()(i))},equalsearch:function(t,e){return v.a.isEmpty(e)?{}:l()({},t,e)},rangesearch:function(t,e){if(v.a.isEmpty(e))return{};var i=e[0],n=e[1];return l()({},t,m()({gt:i,lt:n}))}}}});